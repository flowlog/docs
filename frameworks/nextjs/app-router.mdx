---
title: "Next.js App Router"
description: "Learn how to send your first event to using Flowlog SDK"
sidebarTitle: "Next.js App router"
icon: "n"
---

import InstallFlowlogSDK from "/snippets/install-flowlog-sdk.mdx";

<Info>
  **Prerequisite** You should have installed Node.js (version 18.10.0 or
  higher).
</Info>

## Setup Flowlog

<Steps titleSize="h3">
<Step title="Install the SDK in your codebase">

##### To start using Flowlog, you need to install the Flowlog SDK in your project. You can install the SDK using npm, yarn, or pnpm.

<InstallFlowlogSDK />

</Step>
<Step title="Create a 'app/provider' file to initialize the Flowlog SDK">
<CodeGroup>

```jsx javascript
// app/provider.jsx
"use client";
import flowlogJS from "flowlog-js";
import { FlowlogProvider } from "flowlog-js/react";

const analyticsInstance = flowlogJS({
  apiKey: "API_KEY",
});

export function FLProvider({ children }) {
  return (
    <FlowlogProvider client={analyticsInstance}>{children}</FlowlogProvider>
  );
}
```

```tsx typescript
// app/provider.tsx
"use client";
import flowlogJS from "flowlog-js";
import { FlowlogProvider } from "flowlog-js/react";

const analyticsInstance = flowlogJS({
  apiKey: "API_KEY",
});

export function FLProvider({ children }: { children: React.ReactNode }) {
  return (
    <FlowlogProvider client={analyticsInstance}>{children}</FlowlogProvider>
  );
}
```

</CodeGroup>
</Step>
</Steps>

## Start tracking events

<Steps>

<Step title="Track your page views">

##### This method should be called whenever a user visits a new page or screen in your application. Tracking page views helps you understand which pages are visited mostfrequently, how users navigate through your application, and where they may drop off. This data is essential for improving user experience and optimizing your application.

<Info>Create a FlowlogPageView component to listen to URL path changes</Info>

<CodeGroup>

```jsx javascript
// app/FlowlogPageView.js
"use client";

import { usePathname, useSearchParams } from "next/navigation";
import { useEffect } from "react";
import { useFlowlog } from "flowlog-js/react";

export default function FlowlogPageView() {
  const pathname = usePathname();
  const searchParams = useSearchParams();
  const flowlog = useFlowlog();
  // Track pageviews
  useEffect(() => {
    if (pathname && flowlog) {
      let url = window.origin + pathname;
      if (searchParams.toString()) {
        url = url + `?${searchParams.toString()}`;
      }
      flowlog.track("$pageview", {
        $current_url: url,
      });
    }
  }, [pathname, searchParams, flowlog]);

  return null;
}
```

```jsx typescript
// app/FlowlogPageView.tsx
"use client";

import { usePathname, useSearchParams } from "next/navigation";
import { useEffect } from "react";
import { useFlowlog } from "flowlog-js/react";

export default function FlowlogPageView() {
  const pathname = usePathname();
  const searchParams = useSearchParams();
  const flowlog = useFlowlog();
  // Track pageviews
  useEffect(() => {
    if (pathname && flowlog) {
      let url = window.origin + pathname;
      if (searchParams.toString()) {
        url = url + `?${searchParams.toString()}`;
      }
      flowlog.track("$pageview", {
        $current_url: url,
      });
    }
  }, [pathname, searchParams, flowlog]);

  return null;
}
```

</CodeGroup>

##### Then, import the `FLProvider` component into your app/layout file and wrap your app with it. We also dynamically import the `FlowlogPageView` component and include it as a child of `FLProvider`.

<CodeGroup>

```jsx javascript
// app/layout.js
import { FLProvider } from "./providers";

import dynamic from "next/dynamic";

const FlowlogPageView = dynamic(() => import("./FlowlogPageView"), {
  ssr: false,
});

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <FLProvider>
        <body>
          <FlowlogPageView />
          {children}
        </body>
      </FLProvider>
    </html>
  );
}
```

```jsx typescript
// app/layout.tsx
import { FLProvider } from "./providers";
import dynamic from "next/dynamic";

const FlowlogPageView = dynamic(() => import("./FlowlogPageView"), {
  ssr: false,
});

export default function RootLayout({
  children,
}: {
  children: React.ReactNode,
}) {
  return (
    <html lang="en">
      <FLProvider>
        <body>
          <FlowlogPageView />
          {children}
        </body>
      </FLProvider>
    </html>
  );
}
```

</CodeGroup>

</Step>
<Step title="Tracking custom events">

##### Tracking custom events provides insights into user interactions beyond simple page views. By capturing actions like button clicks, form submissions, or any other user interactions, you can gain a deeper understanding of user behavior and the effectiveness of different elements in your application.

<Note>Custom event without custom properties</Note>
<CodeGroup>

```jsx pages/index.js
import { useFlowlog } from "flowlog-js/react";

export default function Index() {
  const flowlog = useFlowlog();

  return (
    <div>
      <h1>Home</h1>
      <button
        onClick={() => {
          flowlog?.track("click_button_count");
        }}
      >
        Click here
      </button>
    </div>
  );
}
```

</CodeGroup>
<Note>Custom event without custom properties</Note>
<CodeGroup>

```jsx pages/index.js
import { useFlowlog } from "flowlog-js/react";

export default function Index() {
  const flowlog = useFlowlog();

  return (
    <div>
      <h1>Home</h1>
      <button
        onClick={() => {
          flowlog?.track("plan_update", {
            // Use up to 15 custom properties
            plan: "premium",
            price: 99.99,
            currency: "USD",
          });
        }}
      >
        Upgrade plan
      </button>
    </div>
  );
}
```

</CodeGroup>

### Reserved properties for custom events

##### Flowlog had some reserved properties to help you organize your information

| Property          | Description                                                                        |
| ----------------- | ---------------------------------------------------------------------------------- |
| $browser          | The name of the browser being used by the user.                                    |
| $browser_language | The language setting of the user's browser.                                        |
| $browser_version  | The version of the browser being used.                                             |
| $current_url      | The current URL of the webpage the user is on.                                     |
| $os               | The operating system of the user's device.                                         |
| $screen_height    | The height of the user's screen in pixels.                                         |
| $screen_width     | The width of the user's screen in pixels.                                          |
| $viewport_height  | The height of the user's browser viewport (visible area of the webpage) in pixels. |
| $viewport_width:  | The width of the user's browser viewport (visible area of the webpage) in pixels.  |
| $referrer         | The URL of the previous webpage that referred the user to the current page.        |

<Warning>
  This properties are automatic track everytime you send a event, avoid to send
  custom properties with the $ prefix, Flowlog will not ingest those properties
</Warning>

##### Also, Flowlog has a reserved property to track the success or error of the event

- `status`: To avoid send multiple custom events for example `plan_update_error` or `plan_update_success` to reflect an error. Use this reserved property to track the success or error of the event. You can use the HTTP status code to track the success or error of the event.

<CodeGroup>

```js success
function handlePlanUpgrade() {
  flowlog?.track("plan_update", {
    // Use code to track the success of the event
    status: "success",
    plan: "premium",
    price: 99.99,
    currency: "USD",
  });
}
```

```js error
function handlePlanUpgrade() {
  flowlog?.track("plan_update", {
    // Use 400 to track an error of the event
    status: "error",
    error: "Plan update failed",
    plan: "premium",
    price: 99.99,
    currency: "USD",
  });
}
```

</CodeGroup>

<Tip>
  Flowlog is prepared to show you the result of the event in the dashboard
</Tip>

</Step>

<Step title="Identify your users">

##### This method should be called whenever a user logs in or registers in your application. Identifying users allows you to track individual user behavior over time. By associating events with specific users, you can personalize experiences, perform user-specific analysis, and improve retention by understanding user journeys and preferences.

<Info>
  When Flowlog detects a new user, it assigns an anonymous ID to the user while
  they are not identified. Once you identify your users, Flowlog merges the
  anonymous ID with the ID you provide in the identify method.
</Info>

<Tip>
  {" "}
  Flowlog recommends using database IDs, in uuidv4 format, instead of email addresses
  or usernames because database IDs never change. That guarantees that even if the
  user changes their email address, you can still recognize them as the same person
  in all of your analytics tools, and you’ll be able to correlate analytics data
  with your own internal database.{" "}
</Tip>

<CodeGroup>

```ts main.ts
flowlog.identify("your-user-database-ID", {
  // Set up to 15 custom properties to your user
  email: "user@example.com",
  name: "John Doe",
  phone: "+1234567890",
  plan: "Premium",
});
```

</CodeGroup>

<Tip>
  Use this method once you have the information of the user available, this
  helps to track the user's behavior and actions.
</Tip>

### Reserved properties for identified users

##### Flowlog had some reserved properties to help you organize your users information and track their behavior

| Property    | Description                                                                                  |
| ----------- | -------------------------------------------------------------------------------------------- |
| name        | Full name of user                                                                            |
| firstName   | First name of a user                                                                         |
| lastName    | Last name of a user                                                                          |
| username    | usually a handle                                                                             |
| email       | User email                                                                                   |
| phone       | Users phone number                                                                           |
| description | Description of the user                                                                      |
| age         | Age of a user                                                                                |
| address     | Street address of a user optionally containing: city, country, postalCode, state, or street  |
| avatar      | URL to an avatar image for the user                                                          |
| birthday    | User’s birthday                                                                              |
| company     | Company the user represents                                                                  |
| title       | Title of a user, usually related to their position at a company Example: “VP of Engineering” |
| website     | Reported age                                                                                 |
| id          | The ID of the user on your database                                                          |
| createdAt   | Date the user’s account was first created. Segment recommends using ISO-8601 date strings.   |

<Tip>
  You can set this reserved properties to track the user's behavior and actions
  along up to 15 more custom properties
</Tip>

</Step>

</Steps>

## Tips for tracking events

##### Some recomendations to track events

### Take your time to plan what to track

##### Take your time to plan what to track. Think about the key actions users can take in your application and what data you need to capture to understand user behavior and improve your application.

<Tip>
  World-class teams plan ahead to determine what to track in order to ensure
  better quality data.
</Tip>

### Track entire user flows

##### To understand how users interact with your application, track entire user flows from the moment they land on your site to the moment they leave. This will help you identify common paths users take, where they drop off, and how you can optimize their experience. For example an `Onboarding process`, a `Checkout process`, or a `Subscription process`

<Tip>
  Flowlog was built to support Flows as a way to track the entire user journey
  on your app
</Tip>

### Use a consistent event naming convention

##### Use a consistent naming convention for your events, the robust way to do it is with snake-case to make it easier to analyze and compare data across different events. For example, if you have a button click event, you could name it `click_button`, `purchase_product`, `update_plan`.
